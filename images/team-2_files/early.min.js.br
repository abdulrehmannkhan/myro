self.global=self;var v=(t,s,e,i)=>{var l;if(t)window.userStateXHR={readyState:4,status:200,responseText:t};else if(window.Fig){if(i||!window.INITIAL_OPTIONS.user_data){window.startUserStateXHR=()=>{};return}window.startUserStateXHR=function(n){var I;var o="/api/user/state",a=[];window.INITIAL_OPTIONS.org_id&&a.push("org_id="+window.INITIAL_OPTIONS.org_id),e&&a.push("omit_core_data=1"),n&&a.push("file_key="+n),a.length!==0&&(o+="?"+a.join("&")),window.userStateXHR=new XMLHttpRequest,window.userStateXHR.open("GET",o);let d=(I=window.INITIAL_OPTIONS.user_data)==null?void 0:I.id;d&&window.userStateXHR.setRequestHeader("X-Figma-User-ID",d),window.userStateXHR.send();var f=window.performance?window.performance.now():-1;window.userStateXHR.addEventListener("load",function(){window.userStateXHRDuration=window.performance?window.performance.now()-f:-1},!1),window.sessionStateXHR=new XMLHttpRequest,window.sessionStateXHR.open("GET","/api/session/state"),d&&window.sessionStateXHR.setRequestHeader("X-Figma-User-ID",d),window.sessionStateXHR.send()};let r=location.pathname==="/preload-editor"||location.pathname==="/file/new",w=window.INITIAL_OPTIONS.editing_file&&window.INITIAL_OPTIONS.editing_file.key;s?window.startUserStateXHR(w):r||window.startUserStateXHR()}else if(location.pathname.startsWith("/community")){window.sessionStateXHR=new XMLHttpRequest,window.sessionStateXHR.open("GET","/api/session/state");let r=(l=window.INITIAL_OPTIONS.user_data)==null?void 0:l.id;r&&window.sessionStateXHR.setRequestHeader("X-Figma-User-ID",r),window.sessionStateXHR.send()}};function k(t){return t==="dark"?"1E1E1E":"F5F5F5"}function D(){var i;if(!((i=window.INITIAL_OPTIONS.feature_flags)!=null&&i.send_initial_bg_color))return"";let t=null;try{t=window.localStorage}catch(l){}let s=F(t),e=U(s);return k(e)}var H="global-debug-theme-preference";function F(t){var s;if(t){let e=t==null?void 0:t.getItem(H);return(s=window.INITIAL_OPTIONS.feature_flags)!=null&&s.ee_system_theme_default&&!e?"system":e}return null}var M=window.matchMedia("(prefers-color-scheme: dark)");function U(t){return t==="system"?M.matches?"dark":"light":t==="dark"?"dark":"light"}var P="chunked-file-load",$="file-load-streaming-compression",C=5e3,G=(t,s)=>{var r;let e=(r=window.INITIAL_OPTIONS.user_data)==null?void 0:r.id,i=window.INITIAL_OPTIONS.tracking_session_id,l=window.INITIAL_OPTIONS.release_manifest_git_commit;window.mpGlobal={version:73,sock:null,msgs:[],perfMetrics:[],shouldConnectToMultiplayer:t,url({fileKey:w,role:n,oauthToken:o,nodeIds:a,initialBgColor:d,suppressDecodeErrors:f,connectionType:I}){var T,h,m,E,O,N,R,L,A;if(!t)return"";let u=null;s&&w===s.fileKey&&s.targetFileVersion&&(u=s.targetFileVersion);let c="";(n==="editor"||n==="viewerWithCpp")&&a&&(c+=`&scenegraph-queries-initial-nodes=${a}`),n==="editor"&&((T=window.INITIAL_OPTIONS.feature_flags)!=null&&T.ep_editor_incremental_loading||(s==null?void 0:s.forceIncrementalForEditors)===1)&&(s==null?void 0:s.forceIncrementalForEditors)!==0&&(c+="&use-incremental-for-editors=1"),n==="editor"&&((h=window.INITIAL_OPTIONS.feature_flags)!=null&&h.incremental_loading_validation)&&(c+="&incremental-loading-validation=1");let _=1;try{let g=JSON.parse(sessionStorage.getItem("reload_times")||"[0]"),p=g[g.length-1];_=Date.now()-p<5e3?1:0}catch(g){}(n!=="editor"||!((m=window.INITIAL_OPTIONS.feature_flags)!=null&&m.send_initial_bg_color))&&(d="");let S=((E=window.INITIAL_OPTIONS.feature_flags)==null?void 0:E.chunked_file_load)&&I==="initial-load",X=(O=window.INITIAL_OPTIONS.feature_flags)!=null&&O.chunked_size_1000?1e3:(N=window.INITIAL_OPTIONS.feature_flags)!=null&&N.chunked_size_5000?5e3:(R=window.INITIAL_OPTIONS.feature_flags)!=null&&R.chunked_size_10000?1e4:(L=window.INITIAL_OPTIONS.feature_flags)!=null&&L.chunked_size_20000?2e4:C,b=(A=window.INITIAL_OPTIONS.feature_flags)==null?void 0:A.file_load_streaming_compression;return`${location.protocol.replace("http","ws")}//${location.host}/api/multiplayer/${w}?role=${n}&tracking_session_id=${i}&version=${this.version}&recentReload=${_}`+(o?"&oauth_token="+o:"")+c+(e?`&user-id=${e}`:"")+(u?`&target-file-version=${u}`:"")+(l?`&client_release=${l}`:"")+(d?`&initial-bg-color=${d}`:"")+(f?"&suppress-decode-errors":"")+(S?`&${P}`:"")+(S?`&chunk-size=${X}`:"")+(b?`&${$}`:"")},DEBUG_THEME_PREFERENCE_KEY:H,DARK_THEME_MEDIA_QUERY:M,themePreferenceFromLocalStorage:F,getBackgroundColorForTheme:k,getVisibleTheme:U,REQUEST_CHUNKED_FILE_LOAD_PARAM:P,preconnect(w){if(t!==!1){if(this.sock){if(w===this.sock.url&&this.sock.readyState!==WebSocket.CLOSED)return;try{this.sock.close()}catch(n){}}this.sock=new WebSocket(w),this.sock.binaryType="arraybuffer",this.sock.onopen=n=>{this.perfMetrics.push({key:"mp-ws-onopen",ts:performance.now(),nBytes:void 0})},this.sock.onmessage=n=>{let o=new Uint8Array(n.data);this.msgs.push(o),this.perfMetrics.push({key:"mp-ws-onmessage",ts:performance.now(),nBytes:o.length*o.BYTES_PER_ELEMENT})},this.msgs=[],this.perfMetrics=[]}}},s&&mpGlobal.preconnect(mpGlobal.url(s))},y=t=>{let s=()=>{let i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.setAttribute("nonce",window.INITIAL_OPTIONS.csp_nonce),i.crossOrigin="anonymous",i},e=new Promise((i,l)=>{let r=s();r.onload=i,r.src=t,document.head.appendChild(r)});return e.catch(i=>console.error(`Fetching ${t} failed: ${i}`)),e};(()=>{let{file_minimal_user_state:t,mock_user_state_for_tests_json:s,multiplayer_preconnect_options:e,omit_core_data:i,omit_user_state:l,preload_fullscreen_urls:r,should_connect_to_multiplayer:w}=window.EARLY_ARGS||{};if(window.INITIAL_OPTIONS||(window.INITIAL_OPTIONS={}),v(s,!!t,!!i,!!l),e&&(e.initialBgColor=D(),e.connectionType="initial-load"),G(w!==!1,e),!r&&!/FigmaMobile-Android/.test(navigator.userAgent)&&((e==null?void 0:e.role)==="editor"||(e==null?void 0:e.role)==="viewerWithCpp"||(e==null?void 0:e.role)==="prototype")){let n=(e==null?void 0:e.role)==="prototype"?Fig.prototypeLibURLs:Fig.fullscreenURLs,o=fetch(n["compiled_wasm.wasm"]);o.catch(d=>console.error(`Fetching compiled_wasm.wasm failed: ${d}`));let a=y(n["compiled_wasm.js"]);window.FULLSCREEN_PRELOADS={wasm:o,js:a}}})();

//# sourceMappingURL=https://admin.figma.com/admin/esbuild-artifacts/854b6f4ec76b28bf02b1b1fcdcb078a6d1e23e85/js/early.min.js.map